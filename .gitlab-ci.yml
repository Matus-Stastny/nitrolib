image: node:9

stages:
  - build
  - release

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
  - node_modules/

before_script:
  - yarn

build:
  stage: build
  script:
    - yarn bundle
  artifacts:
    paths:
    - data/
    - dist/

test:
  stage: build
  script:
    - yarn test # --coverage

lint:
  stage: build
  script:
    - yarn lint

madge:
  stage: build
  script:
    - yarn madge

flow:
  stage: build
  script:
    - yarn flow check

release:
  stage: release
  script:
    - echo "Upload data/ and dist/ to S3 plz"

storybook:
  stage: release
  script:
    - yarn storybook:build
    - echo "Upload dist/storybook/ to S3 plz"
